<% content_for :title do %><%= @project.title_seo.blank? ? strip_tags(@project.title) : @project.title_seo %><% end %>

<% content_for :body_class do %><%= 'l-%s-page' % [@project.body_class] %><% end %>
<% content_for :yandex_metrica_gaidarfund do %>-<% end %>
<% content_for :social_likes do %><%= @project.likes.html_safe %><% end %>
<% content_for :partners do %><%= @project.partners.html_safe %><% end %>

<% if @project.social_image.exists? %>
    <% content_for :og_image do %><%= "#{request.protocol}#{request.host_with_port}#{@project.social_image(:square)}" %><% end %>
<% end %>

<% content_for :extra_head do %>
    <script type="text/javascript">
        $(function() {
            $('ul.b-main-menu li.item.projects a.link')
                .addClass('selected')
                .html(function(i, html) {
                    return html + ' <b class="b-graphics b-graphics-down-arrow"><b></b></b>';
                });
        });
    </script>
<% end %>

<% content_for :left_column do %>
    <%= render :partial => 'block_links', :locals => {:title => @project.about_title.blank? ? 'О проекте' : @project.about_title, :items => @project.pages} %>
    <%= render :partial => 'filters', :locals => {:show_filters => false, :defaults => {:project_ids => @project.id, :per_page => @project.per_page}} %>
    <%= @project.projects.html_safe %>
<% end %>

<% content_for :content do %>
    <%= render :partial => 'project_header', :locals => {:project => @project} %>
    <div class="l-column-472 l-intercolumn-28">

        <%= form_for(@subscriber, :url => {:controller => 'lectures', :action => 'subscribe'}, :html => {:id => "subscribe_form", :class => ""}, :method => 'post', :remote => true) do |f| %>

              <% if @subscriber.errors.any? %>
                <div id="error_explanation">
                  <h2><%= pluralize(@subscriber.errors.count, "error") %> prohibited this lecture from being saved:</h2>
                  <ul>
                  <% @subscriber.errors.full_messages.each do |msg| %>
                    <li><%= msg %></li>
                  <% end %>
                  </ul>
                </div>
              <% end %>

            <fieldset>
                <div class="b-field b-wide-input">
                    <%= f.label :article_id, "Лекция", :class => "b-label" %>
                    <%= f.select :article_id, @articles, :class => "b-input", :id => "f-lecture" %>
                </div>
                <div class="b-field b-wide-input">
                    <%= f.label :name, "Ваше имя и фамилия", :class => "b-label" %>
                    <%= f.text_field :name, :class => "b-input", :id => "f-fio" %>
                </div>
                <div class="b-field b-wide-input">
                    <%= f.label :email, "Ваш e-mail", :class => "b-label" %>
                    <%= f.text_field :email, :class => "b-input", :id => "f-email" %>
                </div>
                <%= f.submit 'Записаться', :class => "b-submit" %>
            </fieldset>
        <% end %>

        <div id="subscribe_success" class="b-form-message b-last-textblock">Спасибо за&nbsp;помощь организаторам.<br/> Ждем вас!</div>

        <div id="subscribe_already">
            <div class="b-form-message">Вы&nbsp;уже записались на&nbsp;лекцию.</div>
            <%= link_to 'Отказаться от участия', lectures_unsubscribe_path(@lecture), :remote => true, :html => {:class => 'b-action-link'} %>
        </div>

        <script type="text/javascript">
            var subscribe = {
                init: function() {
                    $('#subscribe_form,#subscribe_success,#subscribe_already').hide();
                },
                show_form: function(short) {
                    $('#subscribe_form').show();
                    $('#subscribe_success,#subscribe_already').hide();
                    if(short)
                        $('#subscribe_form').find('input,label').not('input:submit').hide();
                },
                success: function() {
                    $('#subscribe_success').show();
                    $('#subscribe_form,#subscribe_already').hide();
                },
                already: function() {
                    $('#subscribe_already').show();
                    $('#subscribe_form,#subscribe_success').hide();
                },
            }
            subscribe.init();
            <% if @subscribed %>
                subscribe.already();
            <% else %>
                subscribe.show_form(<% if @introduced %>true<% end %>);
            <% end %>
        </script>
    </div>
<% end %>

<% content_for :right_column do %>
    <div class="l-wide-context">
    <div class="l-shift-20">
        <%= @project.right_block.html_safe %>
        <%= render :partial => 'social_links' %>
    </div>
    </div>
<% end %>

<%= render :template => 'layouts/3columns' %>